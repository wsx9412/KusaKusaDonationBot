name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # main 브랜치에 코드가 올라올 때마다 실행됩니다.

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      # 1. Firebase Config 값을 안전하게 주입합니다.
      - name: Replace Secrets (Safe Python Method)
        env:
          FIREBASE_CONFIG: ${{ secrets.FIREBASE_CONFIG }}
        run: |
          # 파이썬을 사용하면 JSON 내부의 따옴표나 줄바꿈을 완벽하게 처리할 수 있습니다.
          python3 -c "
          import os
          file_path = 'index.html'
          with open(file_path, 'r', encoding='utf-8') as f:
              data = f.read()
          
          # 환경변수에서 가져온 실제 Secret 값으로 교체합니다.
          # index.html 내의 __FIREBASE_CONFIG__ 문구를 찾아 바꿉니다.
          new_data = data.replace('__FIREBASE_CONFIG__', os.environ['FIREBASE_CONFIG'])
          
          with open(file_path, 'w', encoding='utf-8') as f:
              f.write(new_data)
          "

      # 2. 결과물을 gh-pages 브랜치에 배포합니다.
      - name: Deploy to GitHub Pages
        uses
